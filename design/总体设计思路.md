# 齿轮磨损数据分析系统 - 总体设计思路

## 1. 设计目标与原则

### 1.1 设计目标
- **科研导向**: 专为齿轮磨损状态研究设计，支持多维度数据对比分析
- **易用性优先**: 研究人员无需编程即可完成复杂的数据分析任务
- **模块化架构**: 便于功能扩展和代码维护
- **高性能**: 处理大容量振动信号数据（每文件460,805个采样点）

### 1.2 设计原则
- **单一职责**: 每个模块专注特定功能域
- **开放封闭**: 对扩展开放，对修改封闭
- **依赖注入**: 通过配置管理实现松耦合
- **面向接口**: 定义清晰的模块间交互接口

## 2. 系统架构概览

### 2.1 整体架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   用户界面层     │    │   业务逻辑层     │    │   数据访问层     │
│                │    │                │    │                │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ │
│ │ Streamlit   │ │◄──►│ │ 信号处理    │ │◄──►│ │ 数据加载器  │ │
│ │ 交互界面    │ │    │ │ 特征提取    │ │    │ │ 缓存管理    │ │
│ └─────────────┘ │    │ └─────────────┘ │    │ └─────────────┘ │
│                │    │                │    │                │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ │
│ │ Plotly      │ │◄──►│ │ 数据分析器  │ │◄──►│ │ CSV解析器   │ │
│ │ 图表渲染    │ │    │ │ 对比算法    │ │    │ │ 格式验证    │ │
│ └─────────────┘ │    │ └─────────────┘ │    │ └─────────────┘ │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2 核心设计思想

#### 2.2.1 分层架构
- **表示层**: Streamlit提供Web界面，负责用户交互和结果展示
- **业务层**: 信号处理、数据分析等核心业务逻辑
- **数据层**: 文件读取、数据缓存和格式解析

#### 2.2.2 组件化设计
每个模块都是独立的功能组件，通过标准接口进行通信：
- **配置驱动**: 通过配置文件统一管理系统参数
- **插件机制**: 新的分析算法可作为插件轻松集成
- **状态管理**: 使用Streamlit的会话状态管理用户操作

## 3. 数据流设计

### 3.1 数据处理流程
```
原始CSV文件 → 数据解析 → 缓存优化 → 信号处理 → 特征提取 → 可视化渲染
      ↓          ↓         ↓         ↓         ↓         ↓
   文件验证   格式标准化   内存管理   滤波/FFT   统计分析   交互图表
```

### 3.2 关键数据结构
```python
# 齿轮状态配置
@dataclass
class GearConfig:
    drive_gear_state: str     # 主动轮状态
    driven_gear_state: str    # 从动轮状态
    torque: int               # 扭矩值
    sensor: str               # 传感器位置
    axis: str                 # 测量方向

# 信号数据包装
@dataclass
class SignalData:
    time_series: np.ndarray   # 时域数据
    sampling_rate: int        # 采样频率
    metadata: dict            # 元数据信息
    config: GearConfig        # 采集配置
```

### 3.3 缓存策略
- **多级缓存**: 文件级缓存 + 通道级缓存 + 计算结果缓存
- **懒加载**: 按需加载指定时间段和通道的数据
- **LRU机制**: 最近最少使用的缓存自动清理

## 4. 模块间交互设计

### 4.1 依赖关系图
```
main.py
  ├── config/settings.py (全局配置)
  ├── ui/ (界面层)
  │   ├── components.py (UI组件)
  │   └── sidebar.py (参数选择)
  ├── data/ (数据层)
  │   ├── loader.py (数据加载)
  │   └── cache_manager.py (缓存管理)
  ├── processing/ (处理层)
  │   ├── signal_processor.py (信号处理)
  │   └── feature_extractor.py (特征提取)
  └── visualization/ (可视化层)
      └── charts.py (图表生成)
```

### 4.2 接口设计
```python
# 抽象接口定义
class DataLoaderInterface:
    def load_data(self, config: GearConfig) -> SignalData: ...
    def get_available_configs(self) -> List[GearConfig]: ...

class SignalProcessorInterface:
    def compute_fft(self, signal: SignalData) -> FrequencyData: ...
    def extract_features(self, signal: SignalData) -> Features: ...

class VisualizerInterface:
    def create_time_chart(self, datasets: List[SignalData]) -> plotly.Figure: ...
    def create_frequency_chart(self, datasets: List[FrequencyData]) -> plotly.Figure: ...
```

## 5. 性能设计考虑

### 5.1 大数据量处理
- **分块读取**: 大文件分块加载，避免内存溢出
- **数据压缩**: 对缓存数据进行压缩存储
- **并行计算**: CPU密集型计算使用多进程并行

### 5.2 交互性能优化
- **增量更新**: 图表数据增量更新而非全量重绘
- **防抖机制**: 用户连续操作时延迟响应，减少不必要计算
- **预计算**: 常用分析结果预计算并缓存

### 5.3 内存管理
- **对象池**: 复用频繁创建的对象
- **数据释放**: 及时释放不再使用的大数据对象
- **内存监控**: 实时监控内存使用情况

## 6. 扩展性设计

### 6.1 算法扩展
```python
# 分析算法插件接口
class AnalysisPlugin:
    def get_name(self) -> str: ...
    def get_description(self) -> str: ...
    def analyze(self, data: SignalData) -> AnalysisResult: ...
    def get_ui_controls(self) -> List[UIControl]: ...
```

### 6.2 数据源扩展
- **多格式支持**: 可扩展支持MAT、HDF5等格式
- **实时数据**: 预留接口支持实时数据流
- **数据库集成**: 支持将分析结果保存到数据库

### 6.3 可视化扩展
- **图表类型**: 支持添加新的图表类型
- **主题定制**: 可配置的图表主题和样式
- **导出格式**: 支持多种格式的结果导出

## 7. 开发与部署策略

### 7.1 开发流程
1. **模块独立开发**: 各模块可并行开发和测试
2. **集成测试**: 定期进行模块间集成测试
3. **用户反馈**: 快速原型验证，根据用户反馈迭代

### 7.2 部署方案
- **本地部署**: `streamlit run main.py` 一键启动
- **容器化**: Docker镜像便于环境一致性
- **云端部署**: 支持部署到云平台供多用户使用

## 8. 质量保证

### 8.1 代码质量
- **类型提示**: 全面使用Python类型提示
- **文档字符串**: 详细的函数和类文档
- **单元测试**: 核心算法模块的单元测试覆盖

### 8.2 用户体验
- **错误处理**: 友好的错误提示和恢复机制
- **进度提示**: 长时间操作显示进度条
- **操作指导**: 内置帮助和使用指南

这个设计思路确保了系统的可维护性、可扩展性和高性能，为齿轮磨损研究提供强大而灵活的数据分析工具。